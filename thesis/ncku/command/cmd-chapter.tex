%
% This file is part of ncku-thesis-template.
%
% ncku-thesis-template is distributed in the hope of usefuling to someone,
% you can redistribute it and/or modify
% it under the terms of the Attribution-NonCommercial-ShareAlike
% 4.0 International.
%
% You should have received a copy of the
% Attribution-NonCommercial-ShareAlike 4.0 International
% along with ncku-thesis-template.
%
% If not, see <http://creativecommons.org/licenses/by-nc-sa/4.0/legalcode.txt>.
%

% Some helper function about chapter and section


% ----------------------------------------------------------------------------

\newcommand{\DisplayChapterHeader}[2]%
{%
 \vspace*{0pt}%
  {%
    \parindent 0pt \centering%
    \Large\bf #1 \par%
    \vskip 15pt%
    \Large \bf #2 \par%
    \nobreak%
    \vskip 35pt%
  }%
  \addcontentsline{toc}{chapter}{#1.\space#2}%
} % End of \newcommand{}

\newcommand{\DisplayChapterHeaderStar}[1]%
{%
  \vspace*{0pt}%
  {%
    \parindent 0pt \centering \Large \bf #1\par%
    \nobreak%
    \vskip 30pt%
  }%
  \addcontentsline{toc}{chapter}{#1}%
} % End of \newcommand{}

% ----------------------------------------------------------------------------

% 使用 \frontmatter, \mainmatter 其實可簡化事情,
% 但這增加不需要的內容在context.tex, 使用bypass的方法已減少同學的煩惱.
\newcommand{\VarPageInMainmatter}{1}
\newcommand{\VarPageNotInMainmatter}{0}
\newcommand{\ValuePageInMainmatter}{\VarPageNotInMainmatter} % Default
\newcommand{\SetValuePageInMainmatter}{%
  \renewcommand{\ValuePageInMainmatter}{\VarPageInMainmatter}}
\newcommand{\GetValuePageInMainmatter}{\ValuePageInMainmatter}

% 這邊是overload latex原生的\chapter{}和\chapter*{}
\RenewDocumentCommand{\chapter}{s m}
{%
  %
  % 檢查是 \chapter*{} 或是 \chapter{}
  \IfBooleanTF{#1}%
  {%
    % \chapter*{}
    %
    % 用\chapter*{}都是前幾頁的內容, 用羅馬數字
    %
    %    Starred
    \DisplayChapterHeaderStar{#2}
  }%
  {%
    % \chapter{}
    %
    % 用\chapter{}都是主要內容, 故用數字
    % 如果第一次使用\chapter{}, 則把頁碼改使用成數字
    \ifthenelse{\equal{\GetValuePageInMainmatter}{\VarPageNotInMainmatter}}%
    {\pagenumbering{arabic}\SetValuePageInMainmatter}{}
    %
    \refstepcounter{chapter}
    %
    %    Non-Starred
    \ifthenelse{\equal{\GetStartAppendixChapter}{\ValueEnableAppendixChapter}}%
    {
      % 開始Appendix Chapter
      \SetAppendixTitleFormatFinalString
      \DisplayChapterHeader{\GetAppendixTitleFormatFinalString}{#2}
    }%
    {
      % 一般Chapter
      \ifthenelse{\equal{\GetChapterTitleLang}{\VarChapterTitleLangEng}}%
      {%
        % 題目為英文
        \DisplayChapterHeader{第\thechapter 章}{#2}
      }%
      {%
        % 題目為中文
        \DisplayChapterHeader{第\thechapter 章}{#2}
      }%
    }%
  }%
} % End of \RenewDocumentCommand{}

% ----------------------------------------------------------------------------

\makeatletter

%%% Restored from latex.ltx--Glenn G. Lai
\def\@startsection#1#2#3#4#5#6{\if@noskipsec \leavevmode \fi
   \par \@tempskipa #4\relax
   \@afterindenttrue
   \ifdim \@tempskipa <\z@
     \@tempskipa -\@tempskipa \@afterindentfalse
   \fi
   \if@nobreak \everypar{}\else
     \addpenalty{\@secpenalty}\addvspace{\@tempskipa}\fi \@ifstar
     {\@ssect{#3}{#4}{#5}{#6}}%
     {\@dblarg{\@sect{#1}{#2}{#3}{#4}{#5}{#6}}}}

 \def\section{\@startsection{section}{1}{\z@}%
    {4.6ex plus -1ex minus -.2ex}{.3ex plus .2ex}{\bf}}
\def\subsection{\@startsection{subsection}{2}{\z@}%
    {3.9ex plus -1ex minus -.2ex}{.2ex plus .2ex}{\bf}}
\def\subsubsection{\@startsection{subsubsection}{3}{\z@}%
    {3.25ex plus -1ex minus -.2ex}{.1ex plus .2ex}{\bf}}

\makeatother

% ----------------------------------------------------------------------------

% Chapters
\DeclareDocumentCommand{\StartChapter}{+m +g}
{%
  \chapter{#1}%
  \IfNoValueF{#2}{\label{#2}}%
} % End of \DeclareDocumentCommand{}

\def \EndChapter {\EndOfPage}

% Section
\DeclareDocumentCommand{\StartSection}{+m +g}
{%
  \section{#1}%
  \IfNoValueF{#2}{\label{#2}}%
} % End of \DeclareDocumentCommand{}

% Sub-Section
\DeclareDocumentCommand{\StartSubSection}{+m +g}
{%
  \subsection{#1}%
  \IfNoValueF{#2}{\label{#2}}%
} % End of \DeclareDocumentCommand{}

% Sub-Sub-Section
\DeclareDocumentCommand{\StartSubSubSection}{+m +g}
{%
  \subsubsection{#1}%
  \IfNoValueF{#2}{\label{#2}}%
} % End of \DeclareDocumentCommand{}

% ----------------------------------------------------------------------------

% Chapter標題改使用 第1章 的方式來顯示
\newcommand\VarChapterTitleLangChi{1}
\newcommand\VarChapterTitleLangEng{0}
\newcommand\VarChapterTitleLang{\VarChapterTitleLangEng}
\newcommand\GetChapterTitleLang{\VarChapterTitleLang}
\newcommand{\ChapterTitleInChi}{\renewcommand{\VarChapterTitleLang}{\VarChapterTitleLangChi}}

% A wrapper to handle \ChapterSectionTitleInChi
\newcommand{\ChapterSectionTitleInChi}
{
  \ChapterTitleInChi
} % End of \newcommand{}

% ----------------------------------------------------------------------------

% 過去的API, 以 Error提醒不能再使用
\newcommand{\ChapterTitleNumInChi}{\errmessage{模版: 由v1.4.1開始, ChapterTitleNumInChi已不能再使用. 請參考最新版的conf.tex使用方式.}\stop}

% ----------------------------------------------------------------------------
