%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Global Distribution Stage}
\label{chap:convext}
%%%%%%%%%%%%%%%%%%%%%%%%%%


In this section, the capacity constraint in bus-pin-aware bus-driven floorplanning
are defined, followed by the introduction of the terminologies
used in our algorithms.

Capacity constraint is illustrated in Figure~\ref{fig::capacity}
(a). There are three buses $B_1$, $B_2$, and
$B_3$ and three modules $m_1$, $m_2$, and $m_3$.
The buses $B_1$ = \{$m_2$, $m_3$\}, $B_2$ = \{$m_1$, $m_3$\},
and $B_3$ = \{$m_1$, $m_2$\}. $bw_i$ is the bus width of bus
$B_i$ and the width and height of each module $m_i$ are
denoted by $w_i$ and $h_i$, respectively.
Due to capacity limitation, some modules can be passed with only
one bus in the same direction. For instance, $bw_2$ + $bw_3 >$
max($w_1$, $h_1$), therefore, the capacity of the module $m_1$ is
not enough for both buses $B_2$ and $B_3$ to pass through.
Compared with existed bus-driven floorplanning algorithms that may
result in an unroutable solution in this example, we can have a
routable solution by exploring the diagonal connection between
different modules in Figure~\ref{fig::capacity} (b). The modified
graph coloring algorithm are proposed to assign the bus components
of the diagonal bus $B_1$ to the same layer such that no extra via
is required at the bend of the bus $B_1$.
\begin{figure}[htb]
  \centering
    %\includegraphics[width=6cm]{Fig/capacity.pdf}
    \centerline{\psfig{figure=Fig/capacity.eps, width=6cm}}
  \caption{
     \small
      (a) Capacity constraint. (b) A routable solution on capacity
      constraint.
   }
  \label{fig::capacity}
\end{figure}
\\
Terminologies used in this paper are introduced as follows:

{\bf Definition 1}: A \textbf{\textit{bus pin}} of an n-bit bus
consists of n pins. The bits of the bus pin are arranged
monotonically from the Least Significant Bit (LSB) to the Most
Significant Bit (MSB), and are equally spaced. The MSB bit is
marked with black color in all figures of this paper. A bus pin is
oriented horizontally or vertically. For example, the bus pins
$BP_1$, $BP_2$, and $BP_6$ are oriented horizontally, and the bus
pins $BP_3$, $BP_4$, and $BP_5$ are oriented vertically in
Figure~\ref{fig::bus_pin_flipping} (a).

{\bf Definition 2}: The \textbf{\textit{position of the bus pin}}
is the position of the bus pin on the module, it can be placed on
any of the four boundaries on the module. For example, the bus pin
$BP_1$ is placed on the lower boundary of the module $m_2$ in
Figure~\ref{fig::bus_pin_flipping} (a).

{\bf Definition 3}:  \textbf{\textit{Turning nodes}} denote the
bends of the buses and they are connected with the horizontal and
vertical buses. For example, there are two turning nodes at the
bend of the bus connecting bus pins $BP_5$ and $BP_6$ in the
Figure~\ref{fig::bus_pin_flipping} (a).

\begin{figure}[htb]
  \centering
    %\includegraphics[width=7cm]{Fig/bus_pin_flipping.pdf}
    \centerline{\psfig{figure=Fig/bus_pin_flipping.eps, width=7cm}}
     \caption{
      \small
      Bus pin flipping.
   }
  \label{fig::bus_pin_flipping}
\end{figure}
\vfill\eject
{\bf Definition 4}: The \textbf{\textit{orientation of the bus
pin}} is defined as the direction from the LSB to the MSB. For
example, the orientation of bus pin $BP_1$ is from east to west,
and the orientation of bus pin $BP_3$ is from north to south in
Figure~\ref{fig::bus_pin_flipping}(a).

{\bf Definition 5}: \textbf{\textit{Bus pin flipping}} is used to
change the orientation of the bus pins. In
Figure~\ref{fig::bus_pin_flipping} (a), the orientation of bus pin
$BP_3$ is from north to south and the orientation of bus pin
$BP_4$ is from south to north. If they are connected with one
horizontal bus, due to their orientation are opposite, bus
twisting makes the signal wires cross at a point and transmit the
wrong data. Furthermore, the orientation of bus pin $BP_5$ is from
north to south and the orientation of bus pin $BP_6$ is from west
to east, and they are connected with a diagonal bus that needs two
extra vias at the turning nodes. All the above problems can be solved
by simply applying bus pin flipping on bus pins $BP_4$ and $BP_6$,
and the results after flipping are shown in Figure~\ref{fig::bus_pin_flipping} (b).

{\bf Definition 6}: Wirelength $``$\textbf{\textit{deviation}}$"$
represents the driver-load wirelength difference among all bits of
the bus. Different choices of the orientations at bus pins and
turning nodes may cause different driver-load wirelength among all
bits. In this paper, we only need to minimize the wirelength
difference between MSB and LSB of the bus because the wirelength
of all other bits can be linearly interpolated by it. The MSB-LSB
wirelength deviation could be expressed by
\begin{eqnarray}
dev_{len} = | len(MSB) - len(LSB)|
\end{eqnarray}
\hspace{4mm}A turning node can contribute $-$D, 0 or $+$D to the MSB-LSB
wirelength difference, where D = 2$BW$ and $BW$ is the bus width.
Accumulating the turning node contributions along the path from
the driver to the load of the bus provides $dev_{len}$ at the
load. Figure~\ref{fig::bus_pin_flipping} illustrates the different
deviation results from the different choices at the turning nodes.
In Figure~\ref{fig::bus_pin_flipping} (b), the deviation from the
bus pin $BP_5$ to the bus pin $BP_6$ is $-$D, while in
Figure~\ref{fig::bus_pin_flipping} (a) is 0, but it needs two
extra vias at the turning nodes. Therefore, it is hard to
optimize the total deviation while no extra via is allowed at the
turning nodes.
